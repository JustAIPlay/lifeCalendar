<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”Ÿå‘½æ—¥å†</title>
    <style>
        /* é»˜è®¤é…è‰²ï¼šæ¸…æ–°è“è°ƒ */
        :root {
            --bg: #F6F8FA;
            --past: #1E88E5;
            --future: #E6EEF6;
            --now: #FFC857;
            --gap: 2px;
            --cell-size: 8px;
        }

        /* æš–è‰²ç³»ï¼šæ¸©æŸ”å²æœˆ */
        .theme-warm {
            --bg: #FFF8F3;
            --past: #D87C56;
            --future: #F6EDEC;
            --now: #FFC857;
        }

        /* å•è‰²é«˜å¯¹æ¯”ï¼šæç®€é»‘ç™½ */
        .theme-monochrome {
            --bg: #FFFFFF;
            --past: #111827;
            --future: #E6E7EB;
            --now: #FFD166;
        }

        body {
            margin: 0;
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--bg);
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        .input-container {
            margin-bottom: 30px;
            text-align: center;
        }

        .theme-selector {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .theme-option {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            border: 2px solid #e1e5e9;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            background-color: white;
        }

        .theme-option:hover {
            border-color: var(--past);
            transform: translateY(-1px);
        }

        .theme-option.active {
            border-color: var(--past);
            background-color: var(--past);
            color: white;
        }

        .theme-preview {
            display: flex;
            gap: 2px;
        }

        .preview-color {
            width: 12px;
            height: 12px;
            border-radius: 2px;
        }

        #birthDate {
            padding: 10px;
            font-size: 16px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            outline: none;
            background-color: white;
        }

        #birthDate:focus {
            border-color: var(--past);
        }

        .calendar-container {
            display: grid;
            grid-template-columns: repeat(52, var(--cell-size));
            gap: var(--gap);
            max-width: 800px;
            margin: 0 auto;
        }

        .week {
            width: var(--cell-size);
            height: var(--cell-size);
            background-color: var(--future);
            border-radius: 1px;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .week:hover {
            transform: scale(1.3);
            z-index: 10;
            position: relative;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .week.past {
            background-color: var(--past);
        }

        .week.present {
            background-color: var(--now);
            transform: scale(1.1);
            box-shadow: 0 0 0 2px rgba(255, 200, 87, 0.3);
        }

        .week.future {
            background-color: var(--future);
        }

        .info {
            margin-top: 20px;
            text-align: center;
            color: #666;
            font-size: 14px;
        }

        .legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 15px;
            font-size: 12px;
            flex-wrap: wrap;
        }

        .card-generator {
            margin-top: 30px;
            text-align: center;
        }

        .generate-btn {
            background-color: var(--past);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .generate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }

        .generate-btn:active {
            transform: translateY(0);
        }

        .card-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .card-modal.show {
            display: flex;
        }

        .card-content {
            background-color: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 90%;
            max-height: 90%;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .card-preview {
            margin: 20px 0;
            text-align: center;
        }

        
        .download-section {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }

        .download-btn {
            background-color: var(--past);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .download-btn:hover {
            transform: translateY(-1px);
        }

        .close-btn {
            background-color: #666;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            background-color: #555;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 2px;
        }
    </style>
</head>
<body>
    <div class="input-container">
        <div class="theme-selector">
            <div class="theme-option active" data-theme="default">
                <div class="theme-preview">
                    <div class="preview-color" style="background-color: #1E88E5;"></div>
                    <div class="preview-color" style="background-color: #FFC857;"></div>
                    <div class="preview-color" style="background-color: #E6EEF6;"></div>
                </div>
                <span>æ¸…æ–°è“è°ƒ</span>
            </div>
            <div class="theme-option" data-theme="warm">
                <div class="theme-preview">
                    <div class="preview-color" style="background-color: #D87C56;"></div>
                    <div class="preview-color" style="background-color: #FFC857;"></div>
                    <div class="preview-color" style="background-color: #F6EDEC;"></div>
                </div>
                <span>æ¸©æŸ”å²æœˆ</span>
            </div>
            <div class="theme-option" data-theme="monochrome">
                <div class="theme-preview">
                    <div class="preview-color" style="background-color: #111827;"></div>
                    <div class="preview-color" style="background-color: #FFD166;"></div>
                    <div class="preview-color" style="background-color: #E6E7EB;"></div>
                </div>
                <span>æç®€é»‘ç™½</span>
            </div>
        </div>
        <input type="date" id="birthDate" placeholder="é€‰æ‹©å‡ºç”Ÿæ—¥æœŸ">
    </div>
    
    <div class="calendar-container" id="calendar"></div>
    
    <div class="info">
        <div>æ¯ä¸ªæ ¼å­ä»£è¡¨ä¸€å‘¨ï¼Œæ€»å…±90å¹´ï¼ˆ4680å‘¨ï¼‰</div>
        <div class="legend">
            <div class="legend-item">
                <div class="legend-color" style="background-color: var(--past);"></div>
                <span>å·²åº¦è¿‡</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: var(--now);"></div>
                <span>å½“å‰å‘¨</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: var(--future);"></div>
                <span>æœªæ¥</span>
            </div>
        </div>
        
        <div class="card-generator">
            <button class="generate-btn" onclick="openCardModal()">
                ğŸ¨ ç”Ÿæˆç”Ÿå‘½å¡ç‰‡
            </button>
        </div>
    </div>

    <!-- å¡ç‰‡ç”Ÿæˆæ¨¡æ€æ¡† -->
    <div class="card-modal" id="cardModal">
        <div class="card-content">
            <h2>ç”Ÿæˆä½ çš„ç”Ÿå‘½å¡ç‰‡</h2>
            <div class="card-preview" id="cardPreview">
                <!-- SVGå¡ç‰‡å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
            </div>
            
            <div class="download-section">
                <button class="download-btn" onclick="downloadCard()">ğŸ“¥ ä¸‹è½½PNGå›¾ç‰‡</button>
                <button class="close-btn" onclick="closeCardModal()">å…³é—­</button>
            </div>
        </div>
    </div>

    <script>
        const birthDateInput = document.getElementById('birthDate');
        const calendar = document.getElementById('calendar');
        
        const WEEKS_IN_YEAR = 52;
        const YEARS = 90;
        const TOTAL_WEEKS = WEEKS_IN_YEAR * YEARS;

        function createCalendar() {
            calendar.innerHTML = '';
            
            for (let i = 0; i < TOTAL_WEEKS; i++) {
                const week = document.createElement('div');
                week.className = 'week';
                week.dataset.week = i;
                calendar.appendChild(week);
            }
        }

        function updateCalendar() {
            const birthDate = new Date(birthDateInput.value);
            if (!birthDateInput.value) return;

            const today = new Date();
            const birthTime = birthDate.getTime();
            const todayTime = today.getTime();
            
            const weeksSinceBirth = Math.floor((todayTime - birthTime) / (1000 * 60 * 60 * 24 * 7));
            
            const weeks = document.querySelectorAll('.week');
            weeks.forEach((week, index) => {
                week.className = 'week';
                if (index < weeksSinceBirth) {
                    week.classList.add('past');
                } else if (index === weeksSinceBirth) {
                    week.classList.add('present');
                } else {
                    week.classList.add('future');
                }
            });
        }

        birthDateInput.addEventListener('change', updateCalendar);

        // ä¸»é¢˜åˆ‡æ¢åŠŸèƒ½
        const themeOptions = document.querySelectorAll('.theme-option');
        
        function switchTheme(theme) {
            // ç§»é™¤æ‰€æœ‰ä¸»é¢˜ç±»
            document.body.classList.remove('theme-warm', 'theme-monochrome');
            
            // æ·»åŠ æ–°ä¸»é¢˜ç±»
            if (theme === 'warm') {
                document.body.classList.add('theme-warm');
            } else if (theme === 'monochrome') {
                document.body.classList.add('theme-monochrome');
            }
            
            // æ›´æ–°æ´»è·ƒçŠ¶æ€
            themeOptions.forEach(option => {
                option.classList.remove('active');
                if (option.dataset.theme === theme) {
                    option.classList.add('active');
                }
            });
            
            // é‡æ–°åˆ›å»ºæ—¥å†ä»¥åº”ç”¨æ–°é¢œè‰²
            updateCalendar();
            
            // å¦‚æœå¡ç‰‡æ¨¡æ€æ¡†æ˜¯æ‰“å¼€çš„ï¼Œé‡æ–°ç”Ÿæˆå¡ç‰‡é¢„è§ˆ
            const modal = document.getElementById('cardModal');
            if (modal.classList.contains('show')) {
                generateCardPreview();
            }
        }
        
        themeOptions.forEach(option => {
            option.addEventListener('click', () => {
                switchTheme(option.dataset.theme);
            });
        });

        // åˆå§‹åŒ–æ—¥å†
        createCalendar();
        
        // è®¾ç½®é»˜è®¤æ—¥æœŸä¸ºä»Šå¤©å‡å»30å¹´
        const defaultDate = new Date();
        defaultDate.setFullYear(defaultDate.getFullYear() - 30);
        birthDateInput.value = defaultDate.toISOString().split('T')[0];
        updateCalendar();

        // æš–å¿ƒæ–‡å­—åº“ - ä»words.txtè¯»å–
        const quotes = [
            "ç”Ÿå‘½æ˜¯ç”±ä¸€å‘¨ä¸€å‘¨çš„ç‚¹æ»´ï¼Œç¼–ç»‡æˆçš„æµ©ç€šæ˜Ÿå›¾ã€‚",
            "æ—¶é—´ä¸ä¼šåœä¸‹è„šæ­¥ï¼Œä½†ä¼šåœ¨è®°å¿†é‡Œç•™ä¸‹æ¸©æŸ”çš„å…‰ã€‚",
            "æ¯ä¸€ä¸ªä»Šå¤©ï¼Œéƒ½æ˜¯æœªæ¥å²æœˆé‡Œæœ€å¹´è½»çš„æ—¶åˆ»ã€‚",
            "ä¸å¿…è¿½é—®ç”Ÿå‘½çš„é•¿åº¦ï¼Œçæƒœæ¯ä¸€å¯¸æ­£åœ¨æµåŠ¨çš„æ—¶å…‰ã€‚",
            "æ—¶é—´æ˜¯æœ€å…¬å¹³çš„è€å¸ˆï¼Œä¹Ÿæ˜¯æœ€æ¸©æŸ”çš„é›•åˆ»å¸ˆã€‚",
            "ä½ èµ°è¿‡çš„æ¯ä¸€æ­¥ï¼Œéƒ½åœ¨ä¸ºç”Ÿå‘½æ¶‚æŠ¹ç‹¬ç‰¹çš„è‰²å½©ã€‚",
            "å²æœˆçš„æ„ä¹‰ï¼Œä¸åœ¨è¿œæ–¹ï¼Œè€Œåœ¨æ¯ä¸€ä¸ªè¢«è®¤çœŸåº¦è¿‡çš„ç¬é—´ã€‚",
            "ç”Ÿå‘½æ˜¯ä¸€åœºæ—…ç¨‹ï¼Œç›®çš„åœ°é‡è¦ï¼Œæ²¿é€”çš„é£æ™¯æ›´çè´µã€‚",
            "æ—¶é—´è®©æˆ‘ä»¬æ˜ç™½ï¼šæœ€è€€çœ¼çš„é£æ™¯ï¼Œå¸¸å¸¸åœ¨å¹³å‡¡é‡Œã€‚",
            "ç”Ÿå‘½çš„å®½åº¦ï¼Œç”±çˆ±å’Œçƒ­æƒ…æ¥æ‹“å±•ã€‚",
            "æœªæ¥æ˜¯ä¸€å¼ æœªå®Œæˆçš„ç”»å¸ƒï¼Œç¬”åœ¨ä½ æ‰‹ä¸­ã€‚",
            "å²æœˆä»ä¸è¾œè´Ÿè®¤çœŸç”Ÿæ´»çš„äººã€‚",
            "æ—¶é—´çš„ä»·å€¼ï¼Œä¸åœ¨é•¿çŸ­ï¼Œè€Œåœ¨æµ“æ·¡ã€‚",
            "äººç”Ÿä¸æ˜¯å€’è®¡æ—¶ï¼Œè€Œæ˜¯ç‚¹äº®æ¯ä¸€ä¸ªå±äºä½ çš„å½“ä¸‹ã€‚",
            "å½“ä¸‹è¿™ä¸€åˆ»ï¼Œæ˜¯æˆ‘ä»¬çœŸæ­£èƒ½å¤ŸæŠŠæ¡çš„å…¨éƒ¨ã€‚",
            "ç”Ÿå‘½ä¸å¿…æƒŠè‰³ï¼Œä½†è¦çœŸå®è€Œæ¸©çƒ­ã€‚",
            "æ—¶é—´æ˜¯æœ€æ²‰é»˜çš„è§è¯è€…ï¼Œå´è®°å¾—ä½ æ‰€æœ‰çš„åŠªåŠ›ã€‚",
            "æ¯ä¸€æ¬¡å‘¼å¸ï¼Œéƒ½æ˜¯ç”Ÿå‘½èµ äºˆçš„ç­”å·ã€‚",
            "å²æœˆæ¸©æŸ”ï¼Œå®ƒè®©å¤±å»æˆä¸ºæ‡‚å¾—ï¼Œè®©å¼€å§‹æˆä¸ºå‹‡æ•¢ã€‚",
            "ä¸€ç”Ÿå¤ªçŸ­ï¼ŒçŸ­åˆ°æ¥ä¸åŠæµªè´¹ï¼Œè¶³å¤Ÿå¥½å¥½çƒ­çˆ±ã€‚"
        ];

        let selectedQuote = quotes[0];

        // æ‰“å¼€å¡ç‰‡æ¨¡æ€æ¡†
        function openCardModal() {
            const modal = document.getElementById('cardModal');
            modal.classList.add('show');
            
            // éšæœºé€‰æ‹©æš–å¿ƒæ–‡å­—
            selectedQuote = quotes[Math.floor(Math.random() * quotes.length)];
            
            // ç”Ÿæˆå¡ç‰‡é¢„è§ˆ
            generateCardPreview();
        }

        // å…³é—­å¡ç‰‡æ¨¡æ€æ¡†
        function closeCardModal() {
            const modal = document.getElementById('cardModal');
            modal.classList.remove('show');
        }

        // è·å–å½“å‰ä¸»é¢˜é¢œè‰²
        function getCurrentThemeColors() {
            // æ£€æŸ¥å½“å‰åº”ç”¨çš„ä¸»é¢˜
            let colors;
            if (document.body.classList.contains('theme-warm')) {
                colors = {
                    bg: '#FFF8F3',
                    past: '#D87C56',
                    future: '#F6EDEC',
                    now: '#FFC857'
                };
            } else if (document.body.classList.contains('theme-monochrome')) {
                colors = {
                    bg: '#FFFFFF',
                    past: '#111827',
                    future: '#E6E7EB',
                    now: '#FFD166'
                };
            } else {
                colors = {
                    bg: '#F6F8FA',
                    past: '#1E88E5',
                    future: '#E6EEF6',
                    now: '#FFC857'
                };
            }
            return colors;
        }

        // ç”Ÿæˆå¡ç‰‡é¢„è§ˆ
        function generateCardPreview() {
            const birthDate = new Date(birthDateInput.value);
            const today = new Date();
            const birthTime = birthDate.getTime();
            const todayTime = today.getTime();
            const weeksSinceBirth = Math.floor((todayTime - birthTime) / (1000 * 60 * 60 * 24 * 7));
            
            const colors = getCurrentThemeColors();
            const svg = createSVGCard(birthDate, weeksSinceBirth, colors, selectedQuote);
            
            const preview = document.getElementById('cardPreview');
            preview.innerHTML = svg;
        }

        // åˆ›å»ºSVGå¡ç‰‡
        function createSVGCard(birthDate, weeksLived, colors, quote) {
            const width = 800;
            const height = 500;
            const totalWeeks = 4680;
            const percentage = ((weeksLived / totalWeeks) * 100).toFixed(1);

            // ç¼©ç•¥æ ¼å­å›¾è®¾ç½®
            const cellSize = 3;
            const gap = 1;
            const cols = 52;
            const rows = 90;
            const gridWidth = cols * (cellSize + gap);
            const gridHeight = rows * (cellSize + gap);
            const startX = (width - gridWidth) / 2;
            const startY = 70;

            let svg = `<svg width="${width}" height="${height}" xmlns="http://www.w3.org/2000/svg">`;
            
            // èƒŒæ™¯
            svg += `<rect width="${width}" height="${height}" fill="${colors.bg}"/>`;
            
            // æ ‡é¢˜
            svg += `<text x="${width/2}" y="35" text-anchor="middle" font-family="Arial, sans-serif" font-size="22" font-weight="bold" fill="${colors.past}">æˆ‘çš„ç”Ÿå‘½æ—¥å†</text>`;
            svg += `<text x="${width/2}" y="60" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" fill="${colors.past}">å·²åº¦è¿‡ ${percentage}%</text>`;
            
            // ç»˜åˆ¶æ ¼å­
            for (let row = 0; row < rows; row++) {
                for (let col = 0; col < cols; col++) {
                    const weekIndex = row * cols + col;
                    const x = startX + col * (cellSize + gap);
                    const y = startY + row * (cellSize + gap);
                    
                    let color = colors.future;
                    if (weekIndex < weeksLived) {
                        color = colors.past;
                    } else if (weekIndex === weeksLived) {
                        color = colors.now;
                    }
                    
                    svg += `<rect x="${x}" y="${y}" width="${cellSize}" height="${cellSize}" fill="${color}" rx="0.5"/>`;
                }
            }
            
            // æš–å¿ƒæ–‡å­— - åœ¨å¡ç‰‡ä¸‹æ–¹å±•ç¤º
            const quoteY = startY + gridHeight + 50;
            svg += `<text x="${width/2}" y="${quoteY}" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-style="italic" fill="${colors.past}">${quote}</text>`;
            
            svg += `</svg>`;
            
            return svg;
        }

        // ä¸‹è½½å¡ç‰‡ä¸ºPNG - ä½¿ç”¨Canvasç›´æ¥ç»˜åˆ¶
        function downloadCard() {
            const birthDate = new Date(birthDateInput.value);
            const today = new Date();
            const birthTime = birthDate.getTime();
            const todayTime = today.getTime();
            const weeksLived = Math.floor((todayTime - birthTime) / (1000 * 60 * 60 * 24 * 7));
            
            const colors = getCurrentThemeColors();
            const quote = selectedQuote;
            
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = 800;
            canvas.height = 500;
            
            // ç»˜åˆ¶èƒŒæ™¯
            ctx.fillStyle = colors.bg;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // è®¡ç®—å‚æ•°
            const totalWeeks = 4680;
            const percentage = ((weeksLived / totalWeeks) * 100).toFixed(1);
            const cellSize = 3;
            const gap = 1;
            const cols = 52;
            const rows = 90;
            const gridWidth = cols * (cellSize + gap);
            const gridHeight = rows * (cellSize + gap);
            const startX = (canvas.width - gridWidth) / 2;
            const startY = 70;
            
            // ç»˜åˆ¶æ ‡é¢˜
            ctx.fillStyle = colors.past;
            ctx.font = 'bold 22px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('æˆ‘çš„ç”Ÿå‘½æ—¥å†', canvas.width / 2, 35);
            
            ctx.font = '16px Arial';
            ctx.fillText(`å·²åº¦è¿‡ ${percentage}%`, canvas.width / 2, 60);
            
            // ç»˜åˆ¶æ ¼å­
            for (let row = 0; row < rows; row++) {
                for (let col = 0; col < cols; col++) {
                    const weekIndex = row * cols + col;
                    const x = startX + col * (cellSize + gap);
                    const y = startY + row * (cellSize + gap);
                    
                    let color = colors.future;
                    if (weekIndex < weeksLived) {
                        color = colors.past;
                    } else if (weekIndex === weeksLived) {
                        color = colors.now;
                    }
                    
                    ctx.fillStyle = color;
                    ctx.fillRect(x, y, cellSize, cellSize);
                }
            }
            
            // ç»˜åˆ¶æš–å¿ƒæ–‡å­—
            ctx.fillStyle = colors.past;
            ctx.font = 'italic 16px Arial';
            ctx.textAlign = 'center';
            const quoteY = startY + gridHeight + 50;
            
            // å¤„ç†æ–‡å­—æ¢è¡Œ
            const maxWidth = 700;
            const words = quote.split('');
            let line = '';
            let lineY = quoteY;
            
            for (let i = 0; i < words.length; i++) {
                const testLine = line + words[i];
                const metrics = ctx.measureText(testLine);
                const testWidth = metrics.width;
                
                if (testWidth > maxWidth && i > 0) {
                    ctx.fillText(line, canvas.width / 2, lineY);
                    line = words[i];
                    lineY += 20;
                } else {
                    line = testLine;
                }
            }
            ctx.fillText(line, canvas.width / 2, lineY);
            
            // ä¸‹è½½å›¾ç‰‡
            canvas.toBlob(function(blob) {
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `life-calendar-${Date.now()}.png`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }, 'image/png');
        }

        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
        document.getElementById('cardModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeCardModal();
            }
        });
    </script>
</body>
</html>